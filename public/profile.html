<!DOCTYPE html>
<html lang="en">
   <head>
      <!-- basic -->
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <!-- mobile metas -->
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="viewport" content="initial-scale=1, maximum-scale=1">
      <!-- site metas -->
      <title>Pluto - Responsive Bootstrap Admin Panel Templates</title>
      <meta name="keywords" content="">
      <meta name="description" content="">
      <meta name="author" content="">
      <!-- site icon -->
      <link rel="icon" href="images/fevicon.png" type="image/png" />
      <!-- bootstrap css -->
      <link rel="stylesheet" href="css/bootstrap.min.css" />
      <!-- site css -->
      <link rel="stylesheet" href="style.css" />
      <!-- responsive css -->
      <link rel="stylesheet" href="css/responsive.css" />
      <!-- color css -->
      <link rel="stylesheet" href="css/colors.css" />
      <!-- select bootstrap -->
      <link rel="stylesheet" href="css/bootstrap-select.css" />
      <!-- scrollbar css -->
      <link rel="stylesheet" href="css/perfect-scrollbar.css" />
      <!-- custom css -->
      <link rel="stylesheet" href="css/custom.css" />
      <!-- calendar file css -->
      <link rel="stylesheet" href="js/semantic.min.css" />
      <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
      <![endif]-->
   </head>
   <body class="inner_page profile_page">
      <div class="full_container">
         <div class="inner_container">
            <!-- Sidebar  -->
            <nav id="sidebar">
               <div class="sidebar_blog_1">
                  <div class="sidebar-header">
                     <div class="logo_section">
                        <a href="index.html"><img class="logo_icon img-responsive" src="images/logo/Gg 1.png" alt="#" /></a>
                     </div>
                  </div>
                  <div class="sidebar_user_info">
                     <div class="icon_setting"></div>
                     <div class="user_profle_side">
                        <div class="user_img"><img class="img-responsive profile-picture" src="images/logo/Gg 1.png" alt="#" /></div>
                        <div class="user_info">
                           <h6 class="userName">Gracify Technologies</h6>
                           <p><span class="online_animation"></span> Online</p>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="sidebar_blog_2">
                  <h4>General</h4>
                  <ul class="list-unstyled components">
                     <li class="active">
                        <a href="dashboard.html"  aria-expanded="false"><i class="fa fa-home yellow_color"></i> <span>Home</span></a>
                     </li>
                     <li><a href="widgets.html"><i class="fa fa-money orange_color"></i> <span>Marketing</span></a></li>
                     <li>
                        <a href="#element" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle"><i class="fa fa-bars purple_color"></i> <span>CRM</span></a>
                        <ul class="collapse list-unstyled" id="element">
                           <li><a href="contact.html">> <span>Contact</span></a></li>
                           <li><a href="media_gallery.html">> <span>Companies</span></a></li>
                           <li><a href="icons.html">> <span>Deals</span></a></li>
                           <li><a href="invoice.html">> <span>Invoice</span></a></li>
                           <li><a href="invoice.html">> <span>Task</span></a></li>
                           <li><a href="email.html">> <span>Inbox</span></a></li>
                           <li><a href="calendar.html">> <span>Calendar</span></a></li>
                           <li><a href="media_gallery.html">> <span>Media Gallery</span></a></li>
                        </ul>
                     </li>
                     <li><a href="tables.html"><i class="fa fa-table purple_color2"></i> <span>Content</span></a></li>
                     <li>
                        <a href="#apps"  aria-expanded="false"><i class="fa fa-object-group blue2_color"></i> <span>Automations</span></a>
                     </li>
                     <li><a href="price.html"><i class="fa fa-money blue1_color"></i> <span>Pricing Tables</span></a></li>
                     </li>
                     <li><a href="map.html"><i class="fa fa-map purple_color2"></i> <span>Map</span></a></li>
                     <li><a href="charts.html"><i class="fa fa-bar-chart-o green_color"></i> <span>Charts</span></a></li>
                     <li><a href="settings.html"><i class="fa fa-cog yellow_color"></i> <span>Settings</span></a></li>
                  </ul>
               </div>
            </nav>
            <!-- end sidebar -->
            <!-- right content -->
            <div id="content">
               <!-- topbar -->
               <div class="topbar">
                  <nav class="navbar navbar-expand-lg navbar-light">
                     <div class="full">
                        <button type="button" id="sidebarCollapse" class="sidebar_toggle"><i class="fa fa-bars"></i></button>
                        <div class="logo_section">
                           <a href="index.html"><img class="img-responsive profile-picture" src="images/logo/Gg 1.png" alt="#" /></a>
                        </div>
                        <div class="right_topbar">
                           <div class="icon_info">
                              <ul>
                                 <li><a href="#"><i class="fa fa-bell-o"></i><span class="badge">2</span></a></li>
                                 <li><a href="#"><i class="fa fa-question-circle"></i></a></li>
                                 <li><a href="#"><i class="fa fa-envelope-o"></i><span class="badge">3</span></a></li>
                              </ul>
                              <ul class="user_profile_dd">
                                 <li>
                                    <a class="dropdown-toggle" data-toggle="dropdown"><img class="img-responsive rounded-circle profile-picture" src="images/logo/Gg 1.png" alt="#" /><span class="userName">Gracify Technologies</span></a>
                                    <div class="dropdown-menu">
                                       <a class="dropdown-item" href="profile.html">My Profile</a>
                                       <a class="dropdown-item" href="settings.html">Settings</a>
                                       <a class="dropdown-item" href="help.html">Help</a>
                                       <a class="dropdown-item" href="#"><span>Log Out</span> <i class="fa fa-sign-out"></i></a>
                                    </div>
                                 </li>
                              </ul>
                           </div>
                        </div>
                     </div>
                  </nav>
               </div>
               <!-- end topbar -->
               <!-- Home inner -->
               <div class="midde_cont">
                  <div class="container-fluid">
                     <div class="row column_title">
                        <div class="col-md-12">
                           <div class="page_title">
                              <h2>Profile</h2>
                           </div>
                        </div>
                     </div>
                     <!-- row -->
                     <div class="row column1">
                        <div class="col-md-2"></div>
                        <div class="col-md-8">
                           <div class="white_shd full margin_bottom_30">
                              <div class="full graph_head">
                                 <div class="heading1 margin_0">
                                    <h2>User profile</h2>
                                 </div>
                              </div>
                              <div class="full price_table padding_infor_info">
                                 <div class="row">
                                    <!-- user profile section --> 
                                    <!-- profile image -->
                                    <div class="col-lg-12">
                                       <div class="full dis_flex center_text">
                                          <div class="profile_img">
                                             <img id="profilePicture" width="180" class="rounded-circle profile-picture" src="images/layout_img/avatar.webp" alt="Profile Picture" />
                                         </div>                                         
                                          <div class="profile_contant">
                                             <div class="contact_inner">
                                                <h3 class="userName">Benhouzz</h3>
                                                <p><strong>About: </strong>Frontend Developer</p>
                                                <ul class="list-unstyled">
                                                   <li><i class="fa fa-envelope-o userEmail "></i> </li>
                                                   <li><i class="fa fa-phone userContact " ></i> </li>
                                                </ul>
                                             </div>
                                             <div class="user_progress_bar">
                                                <div class="progress_bar">
                                                   <!-- Skill Bars -->
                                                   <span class="skill" style="width:85%;">Web Applications <span class="info_valume">85%</span></span>                   
                                                   <div class="progress skill-bar ">
                                                      <div class="progress-bar progress-bar-animated progress-bar-striped" role="progressbar" aria-valuenow="85" aria-valuemin="0" aria-valuemax="100" style="width: 85%;">
                                                      </div>
                                                   </div>
                                                   <span class="skill" style="width:78%;">Website Design <span class="info_valume">78%</span></span>   
                                                   <div class="progress skill-bar">
                                                      <div class="progress-bar progress-bar-animated progress-bar-striped" role="progressbar" aria-valuenow="78" aria-valuemin="0" aria-valuemax="100" style="width: 78%;">
                                                      </div>
                                                   </div>
                                                   <span class="skill" style="width:47%;">Automation & Testing <span class="info_valume">47%</span></span>
                                                   <div class="progress skill-bar">
                                                      <div class="progress-bar progress-bar-animated progress-bar-striped" role="progressbar" aria-valuenow="54" aria-valuemin="0" aria-valuemax="100" style="width: 54%;">
                                                      </div>
                                                   </div>
                                                   <span class="skill" style="width:65%;">UI / UX <span class="info_valume">65%</span></span>
                                                   <div class="progress skill-bar">
                                                      <div class="progress-bar progress-bar-animated progress-bar-striped" role="progressbar" aria-valuenow="65" aria-valuemin="0" aria-valuemax="100" style="width: 65%;">
                                                      </div>
                                                   </div>
                                                </div>
                                             </div>
                                          </div>
                                       </div>
                                       <!-- profile contant section -->
                                       <div class="full inner_elements margin_top_30">
                                          <div class="tab_style2">
                                             <div class="tabbar">
                                                <nav>
                                                   <div class="nav nav-tabs" id="nav-tab" role="tablist">
                                                      <a class="nav-item nav-link active" id="nav-home-tab" data-toggle="tab" href="#recent_activity" role="tab" aria-selected="true">Recent Activity</a>
                                                      <a class="nav-item nav-link" id="nav-profile-tab" data-toggle="tab" href="#project_worked" role="tab" aria-selected="false">Projects Worked on</a>
                                                      <a class="nav-item nav-link" id="nav-contact-tab" data-toggle="tab" href="#profile_section" role="tab" aria-selected="false">Profile</a>
                                                   </div>
                                                </nav>
                                                <div class="tab-content" id="nav-tabContent">
                                                   <div class="tab-pane fade show active" id="recent_activity" role="tabpanel" aria-labelledby="nav-home-tab">
                                                      <div class="msg_list_main">
                                                         <ul class="msg_list">
                                                            <li>
                                                               <span><img src="images/layout_img/avatar.webp" class="img-responsive" alt="#"></span>
                                                               <span>
                                                               <span class="name_user">Taison Jack</span>
                                                               <span class="msg_user">Sed ut perspiciatis unde omnis.</span>
                                                               <span class="time_ago">12 min ago</span>
                                                               </span>
                                                            </li>
                                                            <li>
                                                               <span><img src="images/layout_img/avatar.webp" class="img-responsive" alt="#"></span>
                                                               <span>
                                                               <span class="name_user">Mike John</span>
                                                               <span class="msg_user">On the other hand, we denounce.</span>
                                                               <span class="time_ago">12 min ago</span>
                                                               </span>
                                                            </li>
                                                         </ul>
                                                      </div>
                                                   </div>
                                                   <div class="tab-pane fade" id="project_worked" role="tabpanel" aria-labelledby="nav-profile-tab">
                                                      <p>Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et 
                                                         quasi architecto beatae vitae dicta sunt explicabo. Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos 
                                                         qui ratione voluptatem sequi nesciunt.
                                                      </p>
                                                   </div>
                                                   <div class="tab-pane fade" id="profile_section" role="tabpanel" aria-labelledby="nav-contact-tab">
                                                      <p>Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et 
                                                         quasi architecto beatae vitae dicta sunt explicabo. Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos 
                                                         qui ratione voluptatem sequi nesciunt.
                                                      </p>
                                                   </div>
                                                </div>
                                             </div>
                                          </div>
                                       </div>
                                       <!-- end user profile section -->
                                    </div>
                                 </div>
                              </div>
                           </div>
                           <div class="col-md-2"></div>
                        </div>
                        <!-- end row -->
                     </div>
                     <!-- footer -->
                     <div class="container-fluid">
                        <div class="row">
                           <div class="footer">
                              <p>Copyright © 2024 Designed by Digital Strategies.</p>
                           </div>
                        </div>
                     </div>
                  </div>
                  <!-- end Home inner -->
               </div>
            </div>
         </div>
      </div>
      <!-- jQuery -->
      <script src="js/jquery.min.js"></script>
      <script src="js/popper.min.js"></script>
      <script src="js/bootstrap.min.js"></script>
      <!-- wow animation -->
      <script src="js/animate.js"></script>
      <!-- select country -->
      <script src="js/bootstrap-select.js"></script>
      <!-- owl carousel -->
      <script src="js/owl.carousel.js"></script> 
      <!-- chart js -->
      <script src="js/Chart.min.js"></script>
      <script src="js/Chart.bundle.min.js"></script>
      <script src="js/utils.js"></script>
      <script src="js/analyser.js"></script>
      <!-- nice scrollbar -->
      <script src="js/perfect-scrollbar.min.js"></script>
      <script>
         var ps = new PerfectScrollbar('#sidebar');
      </script>
      <!-- custom js -->
      <script src="js/custom.js"></script>
      <!-- calendar file css -->    
      <script src="js/semantic.min.js"></script>
      <script>
         async function fetchUserProfile() {
     // Fetch tokens from local storage
     const accessToken = localStorage.getItem('accessToken');
     const refreshToken = localStorage.getItem('refreshToken');
     console.log('Fetched tokens from local storage:', { accessToken, refreshToken });
   
     if (!accessToken) {
       console.log('No access token found. Redirecting to login.');
       window.location.href = '/login';
       return;
     }
   
     try {
       console.log('Making GET request to /auth/profile with access token.');
       const response = await fetch('http://localhost:3000/auth/profile', {
         method: 'GET',
         headers: {
           'Content-Type': 'application/json',
           'Authorization': `Bearer ${accessToken}`,
           'x-refresh-token': refreshToken, // Include the refresh token if available
         }
       });
   
       console.log('Profile fetch response status:', response.status);
   
       const data = await response.json();
       console.log('Profile fetch response data:', data);
   
       if (response.ok && data.success) {
         console.log('Data fetch was successful.');
   
         const profile = data.profile;
         console.log('Profile data extracted:', profile);
   
         const profilePictureElements = document.querySelectorAll('.profile-picture');
         if (profilePictureElements.length > 0) {
           console.log('Updating profile picture.');
           profilePictureElements.forEach(element => {
             element.src = profile.profilePicture;
           });
         } else {
           console.warn('Profile picture elements not found.');
         }
   
         const userNameElements = document.querySelectorAll('.userName');
         if (userNameElements.length > 0) {
           console.log('Updating user name.');
           userNameElements.forEach(element => {
             element.textContent = profile.name;
           });
         } else {
           console.warn('User name elements not found.');
         }
   
         const userEmailElements = document.querySelectorAll('.userEmail');
      if (userEmailElements.length > 0) {
        console.log('Updating user email.');
        userEmailElements.forEach(element => {
          element.textContent = profile.email;
        });
      } else {
        console.warn('User email elements not found.');
      }
   
      const userContactElements = document.querySelectorAll('.userContact');
      if (userContactElements.length > 0) {
        console.log('Updating user contact.');
        userContactElements.forEach(element => {
          element.textContent = profile.contact;
        });
      } else {
        console.warn('User contact elements not found.');
      }
   
         const facebookFriendsElement = document.getElementById('facebookFriends');
         if (facebookFriendsElement) {
           console.log('Updating Facebook friends count.');
           facebookFriendsElement.textContent = profile.socialStats.friends;
         } else {
           console.warn('Facebook friends element not found.');
         }
   
         const facebookFeedsElement = document.getElementById('facebookFeeds');
         if (facebookFeedsElement) {
           console.log('Updating Facebook feeds count.');
           facebookFeedsElement.textContent = profile.socialStats.feeds;
         } else {
           console.warn('Facebook feeds element not found.');
         }
   
         console.log('Profile updated successfully:', profile);
       } else {
         console.error('Failed to fetch user profile:', data.message);
         window.location.href = '/login';
       }
     } catch (error) {
       console.error('Error fetching user profile:', error);
       window.location.href = '/login';
     }
   }
   
   // Call fetchUserProfile when the page loads
   document.addEventListener('DOMContentLoaded', () => {
     console.log('Calling fetchUserProfile when the page loads.');
     fetchUserProfile();
   });
   
      </script>
      <script>
         document.addEventListener('DOMContentLoaded', () => {
             console.log('DOM fully loaded and parsed.');
     
             const accessToken = localStorage.getItem('accessToken');
             const refreshToken = localStorage.getItem('refreshToken');
             console.log('Fetched tokens from local storage:', { accessToken, refreshToken });
     
             const profilePicture = document.getElementById('profilePicture');
             console.log('Profile picture element:', profilePicture);
     
             profilePicture.addEventListener('click', () => {
                 console.log('Profile picture clicked.');
     
                 const userConfirmed = confirm('Do you want to change your profile picture?');
                 console.log('User confirmation:', userConfirmed);
     
                 if (userConfirmed) {
                     const fileInput = createFileInput();
                     console.log('File input element created:', fileInput);
     
                     fileInput.addEventListener('change', (event) => {
                         console.log('File input changed:', event);
     
                         const file = event.target.files[0];
                         console.log('Selected file:', file);
     
                         if (file) {
                             uploadProfilePicture(file, accessToken, refreshToken)
                                 .then(data => {
                                     console.log('Upload response data:', data);
     
                                     if (data.success) {
                                         profilePicture.src = data.imageUrl; // Update profile picture with new URL
                                         console.log('Profile picture updated with new URL:', data.imageUrl);
                                     } else {
                                         alert('Failed to update profile picture.');
                                         console.error('Failed to update profile picture:', data);
                                     }
                                 })
                                 .catch(error => {
                                     console.error('Error during profile picture upload:', error);
                                 });
                         }
                     });
     
                     fileInput.click();
                 }
             });
     
             function createFileInput() {
                 console.log('Creating file input element.');
                 const fileInput = document.createElement('input');
                 fileInput.type = 'file';
                 fileInput.accept = 'image/*';
                 fileInput.style.display = 'none';
                 document.body.appendChild(fileInput);
                 console.log('File input element added to the DOM:', fileInput);
                 return fileInput;
             }
     
             function uploadProfilePicture(file, accessToken, refreshToken) {
                 console.log('Uploading profile picture. File:', file);
     
                 const formData = new FormData();
                 formData.append('profilePicture', file);
                 console.log('FormData created:', formData);
     
                 return fetch('/auth/profile/upload-profile-picture', {
                     method: 'POST',
                     body: formData,
                     headers: {
                         'Authorization': `Bearer ${accessToken}`,
                         'x-refresh-token': refreshToken,
                     }
                 })
                 .then(response => {
                     console.log('Server response received:', response);
                     return response.json();
                 });
             }
         });
     </script>            
   </body>
</html>