<!DOCTYPE html>
<html lang="en">
   <head>
      <!-- basic -->
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <!-- mobile metas -->
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="viewport" content="initial-scale=1, maximum-scale=1">
      <!-- site metas -->
      <title>Pluto - Responsive Bootstrap Admin Panel Templates</title>
      <meta name="keywords" content="">
      <meta name="description" content="">
      <meta name="author" content="">
      <!-- site icon -->
      <link rel="icon" href="images/fevicon.png" type="image/png" />
      <!-- bootstrap css -->
      <link rel="stylesheet" href="css/bootstrap.min.css" />
      <!-- site css -->
      <link rel="stylesheet" href="style.css" />
      <!-- responsive css -->
      <link rel="stylesheet" href="css/responsive.css" />
      <!-- color css -->
      <link rel="stylesheet" href="css/colors.css" />
      <!-- select bootstrap -->
      <link rel="stylesheet" href="css/bootstrap-select.css" />
      <!-- scrollbar css -->
      <link rel="stylesheet" href="css/perfect-scrollbar.css" />
      <!-- custom css -->
      <link rel="stylesheet" href="css/custom.css" />
      <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
      <![endif]-->
      <!DOCTYPE html>
      <html lang="en">
      <head>
         <meta charset="UTF-8">
         <meta name="viewport" content="width=device-width, initial-scale=1.0">
         <title>Dashboard</title>
         <!-- CSS Files -->
         <link rel="stylesheet" href="css/bootstrap.min.css">
         <link rel="stylesheet" href="css/font-awesome.min.css">
         <link rel="stylesheet" href="css/animate.css">
         <link rel="stylesheet" href="css/bootstrap-select.css">
         <link rel="stylesheet" href="css/owl.carousel.css">
         <link rel="stylesheet" href="css/style.css">
      </head>
      <body class="Home Home_1">
         <div class="full_container">
            <div class="inner_container">
               <!-- Sidebar -->
               <nav id="sidebar">
                  <div class="sidebar_blog_1">
                     <div class="sidebar-header">
                        <div class="logo_section">
                           <a href="index.html"><img class="logo_icon img-responsive" src="images/layout_img/user_img.jpg" alt="Logo" /></a>
                        </div>
                     </div>
                     <div class="sidebar_user_info">
                        <div class="icon_setting"></div>
                        <div class="user_profle_side">
                           <div class="user_img "><img class="img-responsive profile-picture" src="images/layout_img/user_img.jpg" alt="Profile Picture" /></div>
                           <div class="user_info">
                              <h6 class="userName">John Doe</h6>
                              <p><span class="online_animation"></span> Online</p>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div class="sidebar_blog_2">
                     <h4>General</h4>
                     <ul class="list-unstyled components">
                        <li class="active">
                           <a href="/dashboard" aria-expanded="false"><i class="fa fa-home yellow_color"></i> <span>Home</span></a>
                        </li>
                        <li><a href="widgets.html"><i class="fa fa-money orange_color"></i> <span>Campaigns</span></a></li>
                        <li>
                           <a href="#crmDropdown" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle"><i class="fa fa-bars purple_color"></i> <span>CRM</span></a>
                           <ul class="collapse list-unstyled" id="crmDropdown">
                              <li><a href="contact.html">> <span>Contact</span></a></li>
                              <li><a href="icons.html">> <span>Deals</span></a></li>
                              <li><a href="invoice.html">> <span>Invoice</span></a></li>
                              <li><a href="invoice.html">> <span>Task</span></a></li>
                              <li><a href="email.html">> <span>Inbox</span></a></li>
                              <li><a href="calendar.html">> <span>Calendar</span></a></li>
                              <li><a href="media_gallery.html">> <span>Media Gallery</span></a></li>
                           </ul>
                        </li>
                        <li><a href="tables.html"><i class="fa fa-table purple_color2"></i> <span>Content</span></a></li>
                        <li><a href="#appsDropdown" aria-expanded="false"><i class="fa fa-object-group blue2_color"></i> <span>Automations</span></a></li>
                        <li><a href="price.html"><i class="fa fa-money blue1_color"></i> <span>Chatbots</span></a></li>
                        <li><a href="map.html"><i class="fa fa-map purple_color2"></i> <span>Map</span></a></li>
                        <li><a href="charts.html"><i class="fa fa-bar-chart-o green_color"></i> <span>Charts</span></a></li>
                        <li><a href="settings.html"><i class="fa fa-cog yellow_color"></i> <span>Settings</span></a></li>
                     </ul>
                  </div>
               </nav>
               <!-- End Sidebar -->
               <!-- Right Content -->
               <div id="content">
                  <!-- Topbar -->
                  <div class="topbar">
                     <nav class="navbar navbar-expand-lg navbar-light">
                        <div class="full">
                           <button type="button" id="sidebarCollapse" class="sidebar_toggle"><i class="fa fa-bars"></i></button>
                           <div class="logo_section">
                              <a href="index.html"><img class="img-responsive profile-picture" src="images/layout_img/user_img.jpg" alt="Logo" /></a>
                           </div>
                           <div class="right_topbar">
                              <div class="icon_info">
                                 <ul>
                                    <li><a href="#"><i class="fa fa-bell-o"></i><span class="badge">2</span></a></li>
                                    <li><a href="#"><i class="fa fa-question-circle"></i></a></li>
                                    <li><a href="#"><i class="fa fa-envelope-o"></i><span class="badge">3</span></a></li>
                                 </ul>
                                 <ul class="user_profile_dd">
                                    <li>
                                       <a class="dropdown-toggle" data-toggle="dropdown"><img class="img-responsive rounded-circle profile-picture " src="images/layout_img/user_img.jpg" alt="Profile" /><span class="userName"> John Doe </span></a>
                                       <div class="dropdown-menu">
                                          <a class="dropdown-item" href="profile.html">My Profile</a>
                                          <a class="dropdown-item" href="settings.html">Settings</a>
                                          <a class="dropdown-item" href="help.html">Help</a>
                                          <a class="dropdown-item" id="logout-link" href="#"><span>Log Out</span> <i class="fa fa-sign-out"></i></a>
                                       </div>
                                    </li>
                                 </ul>
                              </div>
                           </div>
                        </div>
                     </nav>
                  </div>
                  <!-- End Topbar -->
                  <!-- Home Inner -->
                  <div class="midde_cont">
                     <div class="container-fluid">
                        <div class="row column_title">
                           <div class="col-md-12">
                              <div class="page_title">
                                 <h2>Home</h2>
                              </div>
                           </div>
                        </div>
                        <div class="row column1">
                           <div class="col-md-6 col-lg-3">
                              <div class="full counter_section margin_bottom_30">
                                 <div class="couter_icon">
                                    <div> 
                                       <i class="fa fa-user yellow_color"></i>
                                    </div>
                                 </div>
                                 <div class="counter_no">
                                    <div>
                                       <p class="total_no">2500</p>
                                       <p class="head_couter">Welcome</p>
                                    </div>
                                 </div>
                              </div>
                           </div>
                           <div class="col-md-6 col-lg-3">
                              <div class="full counter_section margin_bottom_30">
                                 <div class="couter_icon">
                                    <div> 
                                       <i class="fa fa-clock-o blue1_color"></i>
                                    </div>
                                 </div>
                                 <div class="counter_no">
                                    <div>
                                       <p class="total_no">123.50</p>
                                       <p class="head_couter">Average Time</p>
                                    </div>
                                 </div>
                              </div>
                           </div>
                           <div class="col-md-6 col-lg-3">
                              <div class="full counter_section margin_bottom_30">
                                 <div class="couter_icon">
                                    <div> 
                                       <i class="fa fa-cloud-download green_color"></i>
                                    </div>
                                 </div>
                                 <div class="counter_no">
                                    <div>
                                       <p class="total_no">1,805</p>
                                       <p class="head_couter">Collections</p>
                                    </div>
                                 </div>
                              </div>
                           </div>
                           <div class="col-md-6 col-lg-3">
                              <div class="full counter_section margin_bottom_30">
                                 <div class="couter_icon">
                                    <div> 
                                       <i class="fa fa-comments-o red_color"></i>
                                    </div>
                                 </div>
                                 <div class="counter_no">
                                    <div>
                                       <p class="total_no">54</p>
                                       <p class="head_couter">Comments</p>
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>
                        <div class="row column1 social_media_section">
                           <div class="col-md-6 col-lg-3">
                              <div class="full socile_icons fb margin_bottom_30">
                                 <div class="social_icon">
                                    <i class="fa fa-facebook"></i>
                                 </div>
                                 <div class="social_cont">
                                    <ul>
                                       <li>
                                          <span><strong>35k</strong></span>
                                          <span>Friends</span>
                                       </li>
                                       <li>
                                          <span><strong>128</strong></span>
                                          <span>Feeds</span>
                                       </li>
                                    </ul>
                                 </div>
                              </div>
                           </div>
                           <div class="col-md-6 col-lg-3">
                              <div class="full socile_icons tw margin_bottom_30">
                                 <div class="social_icon">
                                    <i class="fa fa-twitter"></i>
                                 </div>
                                 <div class="social_cont">
                                    <ul>
                                       <li>
                                          <span><strong>45k</strong></span>
                                          <span>Followers</span>
                                       </li>
                                       <li>
                                          <span><strong>58</strong></span>
                                          <span>Tweets</span>
                                       </li>
                                    </ul>
                                 </div>
                              </div>
                           </div>
                           <div class="col-md-6 col-lg-3">
                              <div class="full socile_icons gp margin_bottom_30">
                                 <div class="social_icon">
                                    <i class="fa fa-google-plus"></i>
                                 </div>
                                 <div class="social_cont">
                                    <ul>
                                       <li>
                                          <span><strong>15k</strong></span>
                                          <span>Connections</span>
                                       </li>
                                       <li>
                                          <span><strong>21</strong></span>
                                          <span>Posts</span>
                                       </li>
                                    </ul>
                                 </div>
                              </div>
                           </div>
                           <div class="col-md-6 col-lg-3">
                              <div class="full socile_icons yt margin_bottom_30">
                                 <div class="social_icon">
                                    <i class="fa fa-youtube"></i>
                                 </div>
                                 <div class="social_cont">
                                    <ul>
                                       <li>
                                          <span><strong>78k</strong></span>
                                          <span>Subscribers</span>
                                       </li>
                                       <li>
                                          <span><strong>32</strong></span>
                                          <span>Videos</span>
                                       </li>
                                    </ul>
                                 </div>
                              </div>
                           </div>
                        </div>
                        <div class="row column1">
                           <div class="col-md-6 col-lg-3">
                              <div class="full box_shadow">
                                 <div class="inner_section">
                                    <h4 class="heading">Recent Activity</h4>
                                    <div class="activity">
                                       <ul>
                                          <li>
                                             <div class="date">
                                                <h5>September 4</h5>
                                                <p>12:30 PM</p>
                                             </div>
                                             <div class="activity_info">
                                                <p><strong>John Doe</strong> commented on your post.</p>
                                             </div>
                                          </li>
                                          <li>
                                             <div class="date">
                                                <h5>September 3</h5>
                                                <p>8:00 AM</p>
                                             </div>
                                             <div class="activity_info">
                                                <p><strong>Jane Smith</strong> liked your photo.</p>
                                             </div>
                                          </li>
                                          <li>
                                             <div class="date">
                                                <h5>September 2</h5>
                                                <p>3:15 PM</p>
                                             </div>
                                             <div class="activity_info">
                                                <p><strong>Mike Johnson</strong> sent you a message.</p>
                                             </div>
                                          </li>
                                       </ul>
                                    </div>
                                 </div>
                              </div>
                           </div>
                           <div class="col-md-6 col-lg-3">
                              <div class="full box_shadow">
                                 <div class="inner_section">
                                    <h4 class="heading">Recent Notifications</h4>
                                    <div class="notifications">
                                       <ul>
                                          <li>
                                             <div class="notification_icon">
                                                <i class="fa fa-bell-o"></i>
                                             </div>
                                             <div class="notification_info">
                                                <p><strong>System Update</strong> Available.</p>
                                             </div>
                                          </li>
                                          <li>
                                             <div class="notification_icon">
                                                <i class="fa fa-bell-o"></i>
                                             </div>
                                             <div class="notification_info">
                                                <p><strong>New Feature</strong> added to your account.</p>
                                             </div>
                                          </li>
                                          <li>
                                             <div class="notification_icon">
                                                <i class="fa fa-bell-o"></i>
                                             </div>
                                             <div class="notification_info">
                                                <p><strong>Reminder</strong> for your meeting tomorrow.</p>
                                             </div>
                                          </li>
                                       </ul>
                                    </div>
                                 </div>
                              </div>
                           </div>
                           <div class="col-md-6 col-lg-6">
                              <div class="full box_shadow">
                                 <div class="inner_section">
                                    <h4 class="heading">Latest News</h4>
                                    <div class="news">
                                       <ul>
                                          <li>
                                             <div class="news_image">
                                                <img src="images/news_img1.jpg" alt="News Image" />
                                             </div>
                                             <div class="news_info">
                                                <h5>Breaking News</h5>
                                                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>
                                             </div>
                                          </li>
                                          <li>
                                             <div class="news_image">
                                                <img src="images/news_img2.jpg" alt="News Image" />
                                             </div>
                                             <div class="news_info">
                                                <h5>Latest Update</h5>
                                                <p>Vestibulum viverra elit nec mi pellentesque, quis interdum massa pellentesque.</p>
                                             </div>
                                          </li>
                                          <li>
                                             <div class="news_image">
                                                <img src="images/news_img3.jpg" alt="News Image" />
                                             </div>
                                             <div class="news_info">
                                                <h5>New Feature</h5>
                                                <p>Quisque et ante sit amet nulla feugiat vestibulum.</p>
                                             </div>
                                          </li>
                                       </ul>
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
                  <!-- End Home Inner -->
               </div>
               <!-- End Right Content -->
            </div>
         </div>
         <!-- JS Files -->
         <script src="js/jquery.min.js"></script>
         <script src="js/bootstrap.min.js"></script>
         <script src="js/jquery.slimscroll.js"></script>
         <script src="js/modernizr.js"></script>
         <script src="js/jquery.dataTables.js"></script>
         <script src="js/dataTables.bootstrap4.js"></script>
         <script src="js/bootstrap-select.min.js"></script>
         <script src="js/owl.carousel.js"></script>
         <script src="js/custom.js"></script>
      </body>
      </html>      
      <script>
      async function fetchUserProfile() {
  // Fetch tokens from local storage
  const accessToken = localStorage.getItem('accessToken');
  const refreshToken = localStorage.getItem('refreshToken');
  console.log('Fetched tokens from local storage:', { accessToken, refreshToken });

  if (!accessToken) {
    console.log('No access token found. Redirecting to login.');
    window.location.href = '/login';
    return;
  }

  try {
    console.log('Making GET request to /auth/profile with access token.');
    const response = await fetch('http://localhost:3000/auth/profile', {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${accessToken}`,
        'x-refresh-token': refreshToken, // Include the refresh token if available
      }
    });

    console.log('Profile fetch response status:', response.status);

    const data = await response.json();
    console.log('Profile fetch response data:', data);

    if (response.ok && data.success) {
      console.log('Data fetch was successful.');

      const profile = data.profile;
      console.log('Profile data extracted:', profile);

      const profilePictureElements = document.querySelectorAll('.profile-picture');
      if (profilePictureElements.length > 0) {
        console.log('Updating profile picture.');
        profilePictureElements.forEach(element => {
          element.src = profile.profilePicture;
        });
      } else {
        console.warn('Profile picture elements not found.');
      }

      const userNameElements = document.querySelectorAll('.userName');
      if (userNameElements.length > 0) {
        console.log('Updating user name.');
        userNameElements.forEach(element => {
          element.textContent = profile.name;
        });
      } else {
        console.warn('User name elements not found.');
      }

      const notificationCountElement = document.getElementById('notificationCount');
      if (notificationCountElement) {
        console.log('Updating notifications count.');
        notificationCountElement.textContent = profile.notifications;
      } else {
        console.warn('Notification count element not found.');
      }

      const messageCountElement = document.getElementById('messageCount');
      if (messageCountElement) {
        console.log('Updating messages count.');
        messageCountElement.textContent = profile.messages;
      } else {
        console.warn('Message count element not found.');
      }

      const facebookFriendsElement = document.getElementById('facebookFriends');
      if (facebookFriendsElement) {
        console.log('Updating Facebook friends count.');
        facebookFriendsElement.textContent = profile.socialStats.friends;
      } else {
        console.warn('Facebook friends element not found.');
      }

      const facebookFeedsElement = document.getElementById('facebookFeeds');
      if (facebookFeedsElement) {
        console.log('Updating Facebook feeds count.');
        facebookFeedsElement.textContent = profile.socialStats.feeds;
      } else {
        console.warn('Facebook feeds element not found.');
      }

      console.log('Profile updated successfully:', profile);
    } else {
      console.error('Failed to fetch user profile:', data.message);
      window.location.href = '/login';
    }
  } catch (error) {
    console.error('Error fetching user profile:', error);
    window.location.href = '/login';
  }
}

// Call fetchUserProfile when the page loads
document.addEventListener('DOMContentLoaded', () => {
  console.log('Calling fetchUserProfile when the page loads.');
  fetchUserProfile();
});

   </script>
   
   <script>
      document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('logout-link').addEventListener('click', async function(event) {
          event.preventDefault(); // Prevent default link behavior
          console.log('Logout link clicked'); // Log when the logout link is clicked
    
          try {
            // Fetch request to the logout endpoint
            console.log('Preparing to send logout request');
            const accessToken = localStorage.getItem('accessToken');
            const refreshToken = localStorage.getItem('refreshToken');
            console.log('Access Token:', accessToken);
            console.log('Refresh Token:', refreshToken);
    
            const response = await fetch('http://localhost:3000/auth/logout', {
              method: 'GET',
              headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${accessToken}`,
                'x-refresh-token': refreshToken, // Include the refresh token if available
              }
            });
    
            console.log('Response received from /auth/logout');
            console.log('Response status:', response.status);
    
            if (response.ok) {
              console.log('Logout successful');
              
              // Clear local storage
              localStorage.removeItem('accessToken');
              localStorage.removeItem('refreshToken');
              localStorage.removeItem('userProfile');
              console.log('Local storage cleared');
    
              // Redirect to login page
              console.log('Redirecting to /login');
              window.location.href = '/login';
            } else {
              console.error('Logout failed:', await response.json());
            }
          } catch (err) {
            console.error('Error during logout:', err);
          }
        });
      });
    </script>  
   </body>
</html>