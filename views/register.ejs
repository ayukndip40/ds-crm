<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Basic Meta Tags -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <!-- Mobile Meta Tags -->
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, width=device-width">
    
    <!-- Site Meta Tags -->
    <title>Register - Responsive Bootstrap Admin Panel Templates</title>
    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta name="author" content="">
    
    <!-- Site Icon -->
    <link rel="icon" href="/images/fevicon.png" type="image/png" />
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/style.css" />
    <link rel="stylesheet" href="/css/responsive.css" />
    <link rel="stylesheet" href="/css/colors.css" />
    <link rel="stylesheet" href="/css/bootstrap-select.css" />
    <link rel="stylesheet" href="/css/perfect-scrollbar.css" />
    <link rel="stylesheet" href="/js/semantic.min.css" />
    
    <!-- HTML5 Shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <!-- Custom Styles -->
    <style>
        #profilePicturePreview {
            max-width: 100px;
            max-height: 100px;
            margin-top: 10px;
            display: none;
            border-radius: 50%;
        }
    </style>
</head>
<body class="inner_page register">
    <div class="full_container">
        <div class="container">
            <div class="center verticle_center full_height">
                <div class="login_section">
                    <div class="logo_login">
                        <div class="center">
                            <h1 style="color: azure;">Register</h1>
                        </div>
                    </div>
                    <div class="login_form">
                        <form id="register-form" method="POST" enctype="multipart/form-data">
                            <fieldset>
                                <div class="field">
                                    <label class="label_field">Name :</label>
                                    <input type="text" name="name" placeholder="Full Name" required />
                                </div>
                                <div class="field">
                                    <label class="label_field">Email Address :</label>
                                    <input type="email" name="email" placeholder="E-mail" required />
                                </div>
                                <div class="field">
                                    <label class="label_field">Contact Number :</label>
                                    <input type="text" name="contact" placeholder="Contact Number" required />
                                </div>
                                <div class="field">
                                    <label class="label_field">Password :</label>
                                    <input type="password" name="password" placeholder="Password" required />
                                </div>
                                <div class="field">
                                    <label class="label_field">Gender :</label>
                                    <select name="gender" required>
                                        <option value="M">Male</option>
                                        <option value="F">Female</option>
                                    </select>
                                </div>
                                <div class="field">
                                    <label class="label_field">Country :</label>
                                    <input type="text" name="country" placeholder="Country" required />
                                </div>
                                <div class="field">
                                    <label class="label_field">City :</label>
                                    <input type="text" name="city" placeholder="City" required />
                                </div>
                                <div class="field">
                                    <label class="label_field">Profile Picture :</label>
                                    <input type="file" name="file" accept="image/*" required onchange="previewProfilePicture(event)" />
                                    <img id="profilePicturePreview" src="#" alt="Profile Picture Preview" />
                                </div>
                                <div class="field margin_0">
                                    <button class="main_bt" type="submit">Register</button>
                                </div>
                            </fieldset>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="/js/jquery.min.js"></script>
    <script src="/js/popper.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/animate.js"></script>
    <script src="/js/bootstrap-select.js"></script>
    <script src="/js/perfect-scrollbar.min.js"></script>
    <script>
        var ps = new PerfectScrollbar('#sidebar');
    </script>
    <script src="/js/custom.js"></script>

    <!-- Image Preview Script -->
    <script>
        function previewProfilePicture(event) {
            const input = event.target;
            const preview = document.getElementById('profilePicturePreview');

            if (input.files && input.files[0]) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                };
                
                reader.readAsDataURL(input.files[0]);
            }
        }
    </script>

    <!-- Register Form Submission Script -->
    <script>
       async function registerUser() {
          console.log('Register form submission event triggered');

          // Gather form data
          const name = document.querySelector('input[name="name"]').value;
          const email = document.querySelector('input[name="email"]').value;
          const contact = document.querySelector('input[name="contact"]').value;
          const password = document.querySelector('input[name="password"]').value;
          const gender = document.querySelector('select[name="gender"]').value;
          const country = document.querySelector('input[name="country"]').value;
          const city = document.querySelector('input[name="city"]').value;
          const fileInput = document.querySelector('input[name="file"]');

          // Prepare FormData
          const formData = new FormData();
          formData.append('name', name);
          formData.append('email', email);
          formData.append('contact', contact);
          formData.append('password', password);
          formData.append('gender', gender);
          formData.append('country', country);
          formData.append('city', city);

          if (fileInput && fileInput.files.length > 0) {
            formData.append('file', fileInput.files[0]);
          }

          try {
            console.log('Making POST request to /auth/register.');
            const response = await fetch('/auth/register', {
              method: 'POST',
              body: formData // Send FormData directly
            });

            console.log('Response received from /auth/register');
            console.log('Response status:', response.status);

            const data = await response.json();
            console.log('Response JSON parsed:', data);

            if (response.ok && data.success) {
              alert(data.message);
              console.log('Registration successful');
              window.location.href = '/verify';
            } else {
              alert(data.message); // Display the error message received from the server
              console.error('Registration failed:', data.message);
            }
          } catch (err) {
            console.error('Error during registration:', err);
            alert('An error occurred during registration. Please try again.');
          }
        }

        // Attach event listener to the form
        document.addEventListener('DOMContentLoaded', () => {
          const registerForm = document.getElementById('register-form');
          if (registerForm) {
            registerForm.addEventListener('submit', async function(event) {
              event.preventDefault(); // Prevent default form submission
              await registerUser(); // Call the registration function
            });
          } else {
            console.error('Register form element not found.');
          }
        });
    </script>
</body>
</html>
